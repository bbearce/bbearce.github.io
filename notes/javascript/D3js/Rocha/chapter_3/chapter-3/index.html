<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../../../../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Chapter 3 - Ben's Code Journal</title>
    <link href="../../../../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../../../../css/highlight.css">
    <link href="../../../../../../css/extra.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../../../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Selecting and Binding Data", url: "#_top", children: [
              {title: "Selecting and appending", url: "#selecting-and-appending" },
              {title: "Binding Data", url: "#binding-data" },
          ]},
          {title: "Creating a bar chart with D3 and HTML", url: "#creating-a-bar-chart-with-d3-and-html", children: [
              {title: "Binding data to HTML", url: "#binding-data-to-html" },
              {title: "Scales", url: "#scales" },
              {title: "Array utilities", url: "#array-utilities" },
              {title: "Adding labels", url: "#adding-labels" },
              {title: "More labels, formatting, and colors", url: "#more-labels-formatting-and-colors" },
              {title: "Changing colors", url: "#changing-colors" },
              {title: "Loading external files", url: "#loading-external-files" },
          ]},
          {title: "Creating a bar chart with D3 and SVG", url: "#creating-a-bar-chart-with-d3-and-svg", children: [
          ]},
        ];

    </script>
    <script src="../../../../../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../../../basics/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../../../basics/" class="btn btn-xs btn-link">
        Basics
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../chapter_2/chapter-2/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../chapter_2/chapter-2/" class="btn btn-xs btn-link">
        Chapter 2
      </a>
    </div>
    
  </div>

    

    <blockquote>
<p>Source <a href="https://github.com/PacktPublishing/Learn-D3.js/tree/master/Chapter03">github</a></p>
</blockquote>
<h2 id="selecting-and-binding-data">Selecting and Binding Data</h2>
<h3 id="selecting-and-appending">Selecting and appending</h3>
<p>The selection methods <code>select()</code> and <code>selectAll()</code> receive a CSS selector expression and return a D3 handle for a node or a set of nodes. You can convert the D3 handle into a DOM object calling <code>node()</code> or <code>nodes()</code>.</p>
<p>Add the following HTML to the <code>&lt;body&gt;</code> of your HTML file (or use Selecting/1-select.html):</p>
<pre><code class="html">&lt;p&gt;See results in console log.&lt;/p&gt;
&lt;div id=&quot;section&quot;&gt;
    &lt;p class=first&gt;Paragraph 1&lt;/p&gt;
    &lt;p&gt;Paragraph 2&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Paragraph 3&lt;/p&gt;
</code></pre>

<p>Now you can use the JavaScript console (or a <code>&lt;script&gt;</code> block in your page) to type in the following code, which shows how <code>select()</code> and <code>selectAll()</code> can be used:</p>
<pre><code class="js">const div = d3.select(&quot;#section&quot;);       // selects element with the 
                                         // &quot;section&quot; ID
const domDiv = div.node();               // converts the object into a 
                                         // DOM node
const firstP = d3.select(&quot;p&quot;);           // selects the first &lt;p&gt; 
                                         // in the page
const allParagraphs = d3.selectAll(&quot;p&quot;); // selects all four &lt;p&gt; nodes 
                                         // in the page
const allPDom = allParagraphs.nodes();   // converts selection into 
                                         // DOM nodelist

const sectionParagraphs =
         d3.select(&quot;div&quot;)
                 .selectAll(&quot;p&quot;);       // selects the two &lt;p&gt; nodes 
                                        // inside &lt;div&gt;
</code></pre>

<p>A selection object serves as a handle to elements in your page. You can use it to change their styles, properties, attributes, classes, and contents, using methods that can receive static or dynamic values (using functions) as parameters. The following examples demonstrate some of these methods (see <code>Selecting/2-attributes-styles.html</code>):</p>
<pre><code class="js">div.style('border', 'solid blue 2px'); // draws blue border around &lt;div&gt;
firstP.classed('big', true);           // adds class ‘.big’ to 
                                         first paragraph 
firstP.text('This is paragraph zero'); // replaces contents of 
                                         first paragraph
allParagraphs.style('font-weight', 'bold'); // applies style to set 
                                              of paragraphs


// this looks promising, however there is nothing tagged with class &quot;first&quot; so nothing happes
d3.select('.first') // selects first element of class ‘.first’
        .attr('title', 'Tooltip')                  // adds an attribute
        .style('font-variant', 'small-caps')       // applies a style
        .html('This is a &lt;b&gt;bold&lt;/b&gt; paragraph.'); // replaces contents with HTML
</code></pre>

<p>The <code>select()</code> method will always return only <strong>one</strong> object (if the selector matches more items, only the first will be returned). The <code>selectAll()</code> method returns a collection, which can be iterated with the <code>each()</code> method, which receives a callback function, which receives up to three parameters. Inside the function, <code>this</code> refers to the current DOM element, and <code>d3.select(this)</code> wraps it in a D3 selection object, which can be manipulated with selection methods, as follows:</p>
<pre><code class="js">sectionParagraphs.each(function(d, i) {     // i is the index
     d3.select(this).classed('red', true);
     console.log(`Paragraph ${i}: `, this); // this refers to the current element
 });
 ```

This code applies the class ```.red``` to each element of a collection. If you open the JavaScript console, it will print each element and its index (starting in zero).

You can also use selection methods to modify the DOM tree. Calling ```remove()``` on a D3 selection removes elements in the selection. You can call ```append()``` on a selection to add an element as its last child, or use ```insert()``` to add the new element in a position determined by a selector passed as the second argument. These methods are demonstrated as follows (see ```Selecting/3-append-remove.html)```:

```js
d3.select(&quot;#section&quot;)     // current context is element with id #section
  .insert(&quot;p&quot;, '.first') // add a &lt;p&gt; before the child being of class ‘.first’
  .append('a')           // context is now &lt;p&gt;; inserts an &lt;a&gt; in &lt;p&gt;
  .attr('href', 'https://d3js.org') // context is now &lt;a&gt; 
  .text(&quot;D3 website&quot;);   // contents of the &lt;a&gt; element

d3.select('div')            // context is first &lt;div&gt; in page
   .select('p:last-of-type') // context is now last &lt;p&gt; in &lt;div&gt;
   .remove(); // context is detached &lt;p&gt; (parentNode is null)

const div = d3.select('div')

div.append(&quot;p&quot;)             // adds a new &lt;p&gt; as last child of selected &lt;div&gt;
    .text(&quot;New paragraph&quot;);  // sets the text contents of &lt;p&gt;

d3.select(&quot;body&quot;)     // selects the &lt;body&gt; element of the page
    .insert(&quot;h1&quot;, &quot;*&quot;)  // adds a new &lt;h1&gt; as the first child (before *)
    .text(&quot;New title&quot;); // sets the text contents of &lt;h1&gt;

d3.select(&quot;body&quot;)
    .append(&quot;h2&quot;)       // adds a new &lt;h2&gt; as the last child
    .text(&quot;Footer&quot;);
</code></pre>

<p>The <code>append()</code> and <code>insert()</code> methods can also be chained, since they return the nodes they added. You just have to pay attention to the current so you don't modify or add data to the wrong elements. The <code>remove()</code> method returns the removed selection (a node or a set of nodes) after it's detached from the DOM (<strong>null</strong> parent).</p>
<p>D3 selections are not limited to HTML. In fact, they are most commonly applied to SVG elements, but can also be used with any embedded XML. This was a brief introduction. In Chapter 4, <strong>Data Binding</strong>, we will explore these methods in detail.</p>
<h3 id="binding-data">Binding Data</h3>
<p>D3 makes it almost trivial to bind data to DOM elements. Data binding requires calling at least two of the following four methods in the context of a selection:</p>
<ul>
<li><code>data(array)</code> or <code>datum(object)</code>: Receives an array or an object/value that contains data that should be mapped to DOM elements  </li>
<li><code>join()</code>, <code>enter()</code> or <code>exit()</code>: Binds the data to DOM elements by populating an update array returned as a selection of elements that should be added or removed from the document  </li>
</ul>
<p>The <code>exit()</code> method returns a selection of unbound elements. After an <code>exit()</code>, <code>remove()</code> is usually called, which removes the entire selection. The <code>enter()</code> method returns a selection of placeholders for new elements that need to be created. After an <code>enter()</code>, either <code>append()</code> or <code>insert()</code> is called, which connects the elements to the DOM tree. The <code>join()</code> method is a magic method that replaces <code>enter()</code> and <code>exit()</code>, automatically updating, removing, or adding elements, as necessary.</p>
<p>Once data is connected to an element, the attributes, style, and contents of each element can be modified using the <code>attr()</code>,<code>style()</code>,<code>text()</code>, and <code>html()</code> methods that take a callback function as the second argument. This binding process is illustrated as follows:</p>
<p><img alt="architecture" src="../architecture.png" /></p>
<p>Let's try an example. Create an HTML page with this code in the <code>&lt;body&gt;</code> and open it in a browser (or use <code>Binding/1-binding.html</code>):</p>
<p>In a <code>&lt;script&gt;</code> block, create this array of numbers (or type it in your JavaScript console):</p>
<pre><code class="js">const numbers = [6, 2, 5, 7, 9];
</code></pre>

<p>The following code will bind each number in the array to a paragraph. The data will be copied to an internal array and can be used to change the attributes, styles, or contents of the existing paragraphs:</p>
<pre><code class="js">const selection = d3.select(&quot;#section&quot;)
                    .selectAll(&quot;p&quot;)
                    .data(numbers);
</code></pre>

<p>The <code>data()</code> method returns the current selection. The value of each item in the array is received as the first parameter of a callback function in attr(),style(),text(), and so on. The text() method is used in the following code that replaces the contents of each paragraph with the first two values of the array:</p>
<pre><code class="js">selection.text(d =&gt; d); // binds to existing paragraphs (update)
</code></pre>

<p>But we need more paragraphs, since we have five elements of data. By calling <code>enter()</code>, a new selection is created with three more placeholder nodes, containing the remaining data, but not yet mapped to any element:</p>
<pre><code class="js">const newSelection = 
     selection.enter(); // binds data to a selection of placeholders
</code></pre>

<p>We can't just call <code>text()</code> on the selection yet. First, we need to append or insert those elements into the DOM tree. You call <code>append()</code> only once, and it will be executed three times. Now, you can use <code>text()</code> to print the paragraph with the data:</p>
<pre><code class="js">newSelection.append(&quot;p&quot;)
             .text(d =&gt; d); // binds to new paragraphs (enter)
</code></pre>

<p>Normally, the entire selecting-binding-appending process is written as a chain of commands. The following code achieves the same result, using the same array and paragraphs (see <code>Binding/3-chain-text.html</code>):</p>
<pre><code class="js">d3.select(&quot;body&quot;)         // select the body element
    .select(&quot;div&quot;)        // select the first div element inside &lt;body&gt;
    .selectAll(&quot;p&quot;)       // select all &lt;p&gt; elements (there are two)
    .data(numbers)        // load the data from the numbers array
    .text(d =&gt; d)         // set contents of existing paragraphs
    .enter()              // bind remaining data to array with 3 elements
    .append(&quot;p&quot;)          // add 3 new &lt;p&gt; elements to end of &lt;div&gt;
    .text(d =&gt; d);        // set the contents of the new paragraphs
</code></pre>

<p>It's simpler (and more common, when using D3) to use JavaScript  (and not HTML) to create <strong>all</strong> of the elements you need. After all, data is dynamic and you won't always know how many items you have to display. Most of the time, HTML is just used to provide the basic structure, such as the <code>&lt;body&gt;</code> tag, a container <code>&lt;div&gt;</code>, or <code>&lt;svg&gt;</code>.</p>
<p>The following code achieves the same result starting with an empty <code>&lt;body&gt;</code> tag (and the same data array). The <code>&lt;div&gt;</code> and all the <code>&lt;p&gt;</code> are created using D3 commands (see <code>Binding/4-empty-binding.html</code>):</p>
<pre><code class="js">d3.select(&quot;body&quot;)        // select the body element
    .append(&quot;div&quot;)       // append a div element inside &lt;body&gt;
    .selectAll(&quot;p&quot;)      // select all &lt;p&gt; elements (there are none)
    .data(numbers)       // load the data from the numbers array
    .enter()             // bind the data to enter array with 5 placeholders
    .append(&quot;p&quot;)         // create 5 new &lt;p&gt; elements and add to end of &lt;div&gt;
    .text(d =&gt; d);       // set the contents of the new paragraphs
</code></pre>

<p>Note that even though there are no <code>&lt;p&gt;</code> elements in the page, the <code>selectAll("p")</code> command is still necessary, since it provides the selection context for the data binding. The <code>selectAll()</code> command can use any CSS selectors to locate its elements, but it should return a selection containing the same type of elements added by the <code>append()</code> command.</p>
<p>As you have seen, once you have data bound to DOM elements, you can use the data to change attributes, styles, classes, and properties, using callbacks. The callback function has a second parameter that contains the index of the data array, which is used in the following example to change the contents and style of list items:</p>
<pre><code class="js">d3.select(&quot;body&quot;)         // select the body element
    .append(&quot;ul&quot;)         // append an &lt;ul&gt; element inside &lt;body&gt;
    .selectAll(&quot;li&quot;)      // select all &lt;li&gt; elements (there are none)
    .data(numbers)        // load the data from the numbers array
    .enter()              // create an enter array with 5 objects
    .append(&quot;li&quot;)         // create 5 new &lt;li&gt; elements and append to &lt;ul&gt;
    .text(function(d, i) {
        return &quot;Item &quot; + (i+1) + &quot;: &quot; + d;
    })
    .style(&quot;font-size&quot;, function(d, i) {
    return ((i+2) * 5) + &quot;pt&quot;;
    });
</code></pre>

<p>The result is shown in the following screenshot:
<img alt="list_example" src="../list_example.png" /></p>
<p>D3 used to create and style new elements from data. Code: <code>Binding/5-callbacks.html</code>.</p>
<p>Callback functions also have a third parameter that contains the array of elements in the selection. You might need it if you want to obtain the current element when using arrow functions, since the <code>this</code> reference in these functions doesn't refer to the current element:</p>
<pre><code class="js">.text( (d, i, nodes) =&gt; console.log(&quot;Current element: &quot; + nodes[i]) );
</code></pre>

<p>You can easily reuse the preceding code with different types of data. If you have an array of objects containing values of different types, you don't need to convert it to an array of numbers. You can directly pass the entire object array to the <code>data()</code> method, and later select which properties of each object you wish to use. For example, you can use practically the same code that was shown previously to display the contents of the following array:</p>
<pre><code class="js">const distances = [
    {name: &quot;Mercury&quot;, distance: 0.387},
    {name: &quot;Venus&quot;, distance: 0.723},
    {name: &quot;Earth&quot;, distance: 1},
    {name: &quot;Mars&quot;, distance: 1.52},
    {name: &quot;Jupiter&quot;, distance: 5.2},
    {name: &quot;Saturn&quot;, distance: 9.54},
    {name: &quot;Uranus&quot;, distance: 19.2},
    {name: &quot;Neptune&quot;, distance: 30.1},
    {name: &quot;Ceres&quot;, distance: 2.765},
    {name: &quot;Pluto&quot;, distance: 39.481},
    {name: &quot;Eris&quot;, distance: 67.67},
    {name: &quot;Haumea&quot;, distance: 43},
    {name: &quot;Makemake&quot;, distance: 45.346}
];
</code></pre>

<p>The object array is received by the <code>data()</code> command. Each array item is available as the first parameter of the callback, which can be used to extract the property that contains the data (see <code>Binding/6-object-array.html</code>):</p>
<pre><code class="js">d3.select(&quot;body&quot;)    // select the body element
    .append(&quot;ul&quot;)     // append an &lt;ul&gt; element inside &lt;body&gt;
    .selectAll(&quot;li&quot;)  // select all &lt;li&gt; elements (there are none)
    .data(distances)  // load the data from the numbers array
    .enter()          // bind the data to enter array with 5 placeholders
    .append(&quot;li&quot;)     // create &lt;li&gt; from enter selection and append to &lt;ul&gt;
    .text(function(d, i) {
        return d.name + &quot;: &quot; + d.distance;
    });
</code></pre>

<p>Since D3 Version 5.8, you can replace <code>enter().append(element)</code> in simple binding operations, as shown with the <code>join(element)</code> method (see <code>Binding/7-join.html</code>):</p>
<pre><code class="js">d3.select(&quot;body&quot;) 
   .append(&quot;ul&quot;) 
   .selectAll(&quot;li&quot;) 
   .data(distances) 
   .join(&quot;li&quot;)  // obtains enter selection and appends 5 new &lt;li&gt; elements
   .text(function(d, i) {
       return d.name + &quot;: &quot; + d.distance;
   });
</code></pre>

<p>The preceding code will generate an HTML list with the data.</p>
<h2 id="creating-a-bar-chart-with-d3-and-html">Creating a bar chart with D3 and HTML</h2>
<p>Now that you have had a quick introduction to D3's basic data-binding mechanisms, let's create some full data visualization examples that will demonstrate the power of D3. You should know HTML very well, so we will start with a simple bar chart using HTML and CSS. Later, we will repeat the exact same procedure using SVG, the main standard used by D3 to create visualizations.</p>
<p>All the code for these examples is available in the GitHub repository for this chapter.</p>
<h3 id="binding-data-to-html">Binding data to HTML</h3>
<p>In this example, we will draw a horizontal bar chart using HTML <code>&lt;div&gt;</code> elements. The colors and length of each bar are controlled by CSS, which we can configure using the <code>selection.style()</code> command. We will use the object array containing planetary distances from the last example. First, let's create a style sheet with classes for the <code>bar-chart</code> and each individual <code>bar</code>:</p>
<pre><code class="html">&lt;style&gt;
    .bar-chart {
        border: solid 1px gray; /* a gray border around the container */
        position: relative;
    }
    .bar {
        height: 20px;
        background-color: orange;
        position: absolute;
    }
&lt;/style&gt;
</code></pre>

<p>The bars are positioned absolutely. Since each bar has an equal height (20px), we need to position each bar slightly below the previous one. This can be achieved by setting the value for the CSS <code>top</code> property (in pixels) so that it contains the sum of the heights of all the previous bars, plus an extra pixel to keep them slightly apart. The <code>top</code> property can be dynamically calculated as proportional to each entry's array index, using a callback in <code>selection.style()</code> (see <code>HTML_Bar/1-bar-chart.html</code>):</p>
<pre><code class="js">d3.select(&quot;body&quot;)
    .append(&quot;div&quot;).attr(&quot;class&quot;, &quot;bar-chart&quot;)                 // container div for the chart
    .style(&quot;height&quot;, () =&gt; distances.length * 21 + &quot;px&quot;)      // set chart height
    .selectAll(&quot;div&quot;).data(distances)                         // binds data
    .enter().append(&quot;div&quot;)                                    // appends a div for each data element
    .attr(&quot;class&quot;, &quot;bar&quot;)                                     // these divs are the bars of  the chart
    .style(&quot;top&quot;, (d,i) =&gt; i * 21 + &quot;px&quot;)                     // stacks bars 
    .style(&quot;width&quot;, &quot;100px&quot;)                                  // fixed width
</code></pre>

<p>output:</p>
<p><img alt="bar_chart_0" src="../bar_chart_0.png" /></p>
<p>This prints all the bars, one on top of the other, but they all have the same static width! We need to use a callback to change the width of each individual bar. In a bar chart, the actual width should be <strong>proportional</strong> to the distance. A solution would be to multiply each value by 10. This will make the smallest bar three pixels wide, and the largest over 670 pixels:</p>
<pre><code class="js">.style(&quot;width&quot;, d =&gt; (d.distance * 10) + &quot;px&quot;)
</code></pre>

<p>Now, the lengths of the bars are proportional to the data values. This code is in <code>HTML_Bar/2-bar-width.html</code>. The result is shown as follows:</p>
<p><img alt="bar_chart_1" src="../bar_chart_1.png" /></p>
<p>HTML bar chart with D3: Drawing DIVs and using the data to change the CSS width. Code: <code>HTML_Bar/2-bar-width.html</code></p>
<h3 id="scales">Scales</h3>
<p>What if a new planet is discovered that is 10 times the largest distance? The bars wouldn't fit and their widths would need to be recalculated! D3 also provides a solution for this: <code>scales</code>.</p>
<p>Scales are mappings between different dimensions. In our case, we have to deal with two dimensions: the dimension of the data, called the <code>domain</code>, and the dimension of the graphics context where the data will be displayed, called the <code>range</code>. Before using a scale, you have to configure its domain and range. There are several different kinds of scales in D3, including linear and logarithmic scales, with many configuration options.</p>
<p>A scale is created with a special generator function available in the <code>d3-scale</code> module. To use this module, you need to load several dependencies, so let's replace the <code>&lt;script&gt;</code> tag with the default bundle:</p>
<pre><code class="html">&lt;script src=&quot;https://d3js.org/d3.v5.min.js&quot;&gt;&lt;/script&gt;
</code></pre>

<p>To create a scale function, you call a special generator function. A linear scale function can be created using the following:</p>
<pre><code class="js">const barScale = d3.scaleLinear();
</code></pre>

<p>To use the scale function you created, you pass a value as the argument and receive the converted result:</p>
<pre><code class="js">const result = barScale(45); // returns 45
</code></pre>

<p>This will return <code>45</code>, because the scale hasn't been configured yet (the default scale is 1:1). To configure the scale, you need to call two methods to set up the domain (data dimensions) and range (graphical dimensions). Each method receives an array. For example, we can set up the domain as follows:</p>
<pre><code class="js">barScale.domain([0, 100]); // input domain from 0 to 100
</code></pre>

<p>This fits all the distances in our data. The range is set up in a similar fashion:</p>
<pre><code class="js">barScale.range([0, 600]); // output domain from 0 to 600
</code></pre>

<p>This means that zero is mapped to zero, and 100 <strong>astronomical units (AU)</strong> is mapped to 600 (pixels). Intermediate values will be interpolated.</p>
<p>If you now call <code>barScale(45)</code>, you will get <code>270</code>. We can use the scale to convert the distances in AU to pixels, replacing the previous expression with a scale conversion (see <code>HTML_Bar/3-scales.html</code>):</p>
<pre><code class="js">.style(&quot;width&quot;, d =&gt; barScale(d.distance) + &quot;px&quot;);
</code></pre>

<h3 id="array-utilities">Array utilities</h3>
<p>We chose 100 as the upper limit in our scale domain because it's larger than any of the distances in the data, but the choice was rather arbitrary. We could have chosen the largest value in the array. If you have hundreds of lines of data, you can use JavaScript array functions (see <strong>Chapter 1, Introduction</strong>) to find out the maximum value.</p>
<p>D3 also includes a collection of array manipulation functions that extend JavaScript's native functions. Some look similar but may be more efficient for data manipulation (for example, by ignoring <code>null</code>, <code>NaN</code>, and <code>undefined</code> values). In order to use them, you need the d3-array module (which is also part of the default bundle).</p>
<p>Here, we changed the configuration of our <code>barScale()</code> function so that it uses the largest distance from the <code>distances</code> object array as the upper value for the domain. This is achieved with by calling the <code>d3.max()</code> function, which receives an array and an accessor function for each array element, as follows:</p>
<pre><code class="js">const barScale = d3.scaleLinear()
                   .domain([0, d3.max(distances, d =&gt; d.distance)]) 
                   .range([0, 600]);
</code></pre>

<p>The <code>d3.max()</code> function will scan the <code>distances</code> array and compare the <code>distance</code> property of each object, returning the largest one.</p>
<p>There are many more useful functions in <strong>d3-array</strong>, which we will cover in the next chapter. Two of them, <code>d3.descending(a,b)</code> and <code>d3.ascending(a,b)</code>, are used to provide a sorting rule for JavaScript's native <code>sort()</code> method. We can use it to sort the array by the distance:</p>
<pre><code class="js">distances.sort((a,b) =&gt; d3.ascending(a.distance, b.distance));
</code></pre>

<p>See and run the code after these transformations in <code>HTML_Bar/4-max-sort.html</code>.</p>
<h3 id="adding-labels">Adding labels</h3>
<p>Since the <code>&lt;div&gt;</code> elements in HTML can contain text, you can call the <code>text()</code> method for each <code>&lt;div&gt;</code> and set its contents based on the data:</p>
<pre><code class="js">d3.select(&quot;body&quot;)
        .append(&quot;div&quot;).attr(&quot;class&quot;, &quot;bar-chart&quot;)
        // ...all previous code to build chart
        .text(d =&gt; d.distance); // display distance in the &lt;div&gt;
</code></pre>

<p>With CSS, we can right-align the text and adjust the fonts. Since these styles are static and don't change with the data, instead of calling <code>style()</code> for each property, you should use a style sheet:</p>
<pre><code class="html">&lt;style&gt;
    /* ... */
    .bar {
        height: 20px;
        left: 100px;
        background-color: orange;
        position: absolute;
        text-align: right;
        padding: 0 5px;
        font-family: sans-serif;
        font-size: 9pt;
    }
&lt;/style&gt;
</code></pre>

<p>As a result, the labels are placed inside the bars, as follows:
<img alt="bar_chart_2" src="../bar_chart_2.png" /></p>
<p>Adding labels to the bars. Code: <code>HTML_Bar/5-labels.html</code>.</p>
<h3 id="more-labels-formatting-and-colors">More labels, formatting, and colors</h3>
<p>Each object in our data array also contains a name property that can be used to label each bar. To position text outside the bar, we will need to refactor the code so that each data entry contains a container <code>&lt;div&gt;</code>, which will be bound to the data values. This entry <code>&lt;div&gt;</code> will then contain three other <code>&lt;div&gt;</code> elements: a category label (the name of the planet), the bar, and a value label (the distance). Classes will be used to identify each <code>&lt;div&gt;</code>. The following style sheet contains the static properties for these elements:</p>
<pre><code class="html">&lt;style&gt;
    .bar-chart {         /* The container &lt;div&gt; for the entire chart */
        border: solid 1px gray;
        position: relative;
        width: 800px;
    }
    .entry {             /* a container &lt;div&gt; for each data entry */
        position: absolute;
        width: 100%;
    }
    .bar {               /* the colored rectangle */
        height: 20px;
        top: 1px;
        left: 100px;
        background-color: orange;
        position: absolute;
    }
    .label {             /* a text label */ 
        padding: 4px 5px;
        font-family: sans-serif;
        font-size: 9pt;
        position: absolute;
        height: 20px;
    } 
    .category {           /* the category text label at left (name) */
        text-align: right;
        width: 80px;
    }
    .value {              /* the value text label at right (distance) */
        text-align: left;
    }
&lt;/style&gt;
</code></pre>

<p>Since each entry <code>&lt;div&gt;</code> has three children, we need to keep a reference to its selection so that the child elements can be appended. The following code saves references for each one of the container <code>&lt;div&gt;</code> elements. The <code>chart</code> constant contains a selection of the root <code>&lt;div&gt;</code> element, and the <code>entries</code> constant contains the selection of all entry <code>&lt;div&gt;</code> elements:</p>
<pre><code class="js">// selects the entire chart (one node)
 const chart = d3.select(&quot;body&quot;)
                 .append(&quot;div&quot;).attr(&quot;class&quot;, &quot;bar-chart&quot;)
                 .style(&quot;height&quot;, distances.length * 21 + &quot;px&quot;);

 // selects each entry (a nodelist)
 const entries = chart.selectAll(&quot;div&quot;).data(distances)
         .enter().append(&quot;div&quot;)
         .attr(&quot;class&quot;, &quot;entry&quot;)
         .style(&quot;top&quot;, (d,i) =&gt; i * 21 + &quot;px&quot;);
</code></pre>

<p>You can now use the <code>entries</code> constant to append the child elements to each entry <code>&lt;div&gt;</code> (see <code>HTML_Bar/6-entries.html</code>):</p>
<pre><code class="js">entries.append(&quot;div&quot;).attr(&quot;class&quot;, &quot;label category&quot;)
        .text(d =&gt; d.name);

entries.append(&quot;div&quot;).attr(&quot;class&quot;, &quot;bar&quot;)
        .style(&quot;width&quot;, d =&gt; barScale(d.distance) + &quot;px&quot;);

entries.append(&quot;div&quot;).attr(&quot;class&quot;, &quot;label value&quot;)
        .style(&quot;left&quot;, d =&gt; (barScale(d.distance) + 100) + &quot;px&quot;)
        .text(d =&gt; d.distance + &quot; AU&quot;);
</code></pre>

<p>Each <code>append()</code> shown is called once for each entry. The attributes, style, and text are set using the data that was bound to the parent container.</p>
<p>You can add child elements without having to break the selection chain with the <code>selection.each()</code> method, which calls a function for each entry. Inside it, you can obtain a selection to the current element using <code>d3.select(this)</code>. The following code produces the same result (see <code>HTML_Bar/7-entries-each.html</code>):</p>
<pre><code class="js">entries.each(function(d) { 
    const entry = d3.select(this); // the current entry
    entry.append(&quot;div&quot;).attr(&quot;class&quot;, &quot;label category&quot;)
         .text(d.name);

    entry.append(&quot;div&quot;).attr(&quot;class&quot;, &quot;bar&quot;)
         .style(&quot;width&quot;, barScale(d.distance) + &quot;px&quot;);

    entry.append(&quot;div&quot;).attr(&quot;class&quot;, &quot;label value&quot;)
         .style(&quot;left&quot;, (barScale(d.distance) + 100) + &quot;px&quot;)
         .text(d.distance + &quot; AU&quot;);
});
</code></pre>

<p>We can improve the rendering of the labels by formatting the numbers to display only two decimal places, using the <code>d3.format()</code> generator function (from the <code>d3-format</code> module). The following code creates a function <code>fmt()</code> that can be used to format numbers:</p>
<pre><code class="js">const fmt = d3.format(&quot;.2f&quot;);
</code></pre>

<p>Now, we can use it to format the distances:</p>
<pre><code class="js">.text(d =&gt; fmt(d.distance) + &quot; AU&quot;);
</code></pre>

<p>The final result is shown as follows:
<img alt="bar_chart_3" src="../bar_chart_3.png" /></p>
<p>Adding category names and placing the formatted label values outside the bars. Code: <code>HTML_Bar/7-entries-each.html</code></p>
<h3 id="changing-colors">Changing colors</h3>
<p>The <strong>d3-colors</strong> module contains functions to generate, convert, and transform colors. Passing any CSS-compatible color representation to <code>d3.color()</code> generates an object with methods that can be used to modify the color. The <code>darker()</code> and <code>brighter()</code> methods receive a value between 0 (no change) and 1 (maximum change) to adjust the lightness component of a color and return a hexadecimal color string.</p>
<p>Let's use this feature to darken the bars when the distance from the sun increases. We will need a scale that maps the <code>distance</code> domain to the [0-1] range, which contains the values accepted by the <code>darker()</code> function:</p>
<pre><code class="js">colorScale = d3.scaleLinear()
        .domain([0, d3.max(distances, d =&gt; d.distance)])
        .range([0,1])
</code></pre>

<p>Now, this colorScale can be used to generate different tones for the bars:</p>
<pre><code class="js">entry.append(&quot;div&quot;).attr(&quot;class&quot;, &quot;bar&quot;)
    .style(&quot;width&quot;, barScale(d.distance) + &quot;px&quot;)
    .style(&quot;background-color&quot;, d3.color('orange')
    .darker(colorScale(d.distance)))
</code></pre>

<p>See the code in <code>HTML_Bar/8-colors.html</code>. The result is shown as follows:
<img alt="bar_chart_4" src="../bar_chart_4.png" /></p>
<p>Changing bar colors with the distance. Code: <code>HTML_Bar/8-colors.html</code></p>
<h3 id="loading-external-files">Loading external files</h3>
<p>Usually, your data will come from external files that need to be loaded with an Ajax request. You can, of course, use jQuery or ECMAScript <code>fetch()</code> commands (and promises, if you need to load multiple files). After loading, you will also need to parse the data and convert it into JavaScript arrays and objects. D3 again provides a more efficient solution in the <code>d3-fetch</code> module: a set of convenient methods for loading and parsing files in popular formats, such as XML, JSON, or CSV. The <code>d3-fetch</code> module is also included in the default bundle.</p>
<p>The planetary data we used in the previous examples is actually part of a larger JSON file containing several properties for planets, asteroids, and satellites. The basic structure of this file (<code>Data/sol_2016.json</code>) is shown as follows:</p>
<pre><code class="js">{
     &quot;star&quot;:{…},
     &quot;planets&quot;:[
         {
             &quot;id&quot;:&quot;p1&quot;,
             &quot;name&quot;:&quot;Mercury&quot;,
             &quot;diameterKm&quot;:4879, 
             &quot;semiMajorAxisAU&quot;:0.387, 
             …
            },{
             &quot;id&quot;:&quot;p2&quot;,
             &quot;name&quot;:&quot;Venus&quot;,
             &quot;diameterKm&quot;:12104, 
             &quot;semiMajorAxisAU&quot;:0.723, 
               …
            }, …
 }
 ```

You can load the data using the ```d3.json()``` function. After it loads and parses the file, it will become available in a callback provided as a parameter to the ```then()``` method (which is a JavaScript promise).

We don't need all the loaded data. The distance used in our examples is stored in the property called ```semiMajorAxisAU```. After loading the file, we can filter the dataset to only save the ```semiMajorAxisAU``` and ```name``` properties. The following code demonstrates this. It loads the file, and it then uses the data obtained in the ```then()``` callback to loop through the planets array, adding only the chosen properties to a new object and pushing it into an array. The array is used to create an HTML list with these properties (see``` Loading/1-loading-json.html```):

```js
//d3.json(&quot;../Data/sol_2016.json&quot;) // if you down load it
d3.json(&quot;https://raw.githubusercontent.com/PacktPublishing/Learn-D3.js/master/Chapter03/Data/sol_2016.json&quot;) // if you use the git hub data. This is so cool!
        .then(function(data) {
            const planets = [];
            data.planets.forEach(function(obj) {
                planets.push({
                    name: obj.name,
                    distance: obj.semiMajorAxisAU
                });
            });
            draw(planets);
        });

function draw(distances) {
    d3.select(&quot;body&quot;).append(&quot;ol&quot;)
      .selectAll(&quot;li&quot;)
      .data(distances)
      .join(&quot;li&quot;)
      .text(d =&gt; d.name + &quot; (&quot; + d.distance + &quot; AU)&quot;);
}
</code></pre>

<p>To apply this to our chart, you just need to replace the contents of the <code>draw()</code> method shown with the entire code used in the previous examples (except for the distances array). See an example in <code>HTML_Bar/9-load-json.html</code>. As an exercise, try feeding the bar chart with a list of Jupiter's moons, instead of the planets (use <code>data.planets[4].satellites</code> to obtain the array, and the <code>semiMajorAxisKm</code> property as the distance, and <code>d3.format(",.0f")</code> to format the distance values).</p>
<p>Full Example:</p>
<pre><code class="js">


d3.json(&quot;https://raw.githubusercontent.com/PacktPublishing/Learn-D3.js/master/Chapter03/Data/sol_2016.json&quot;) // if you use the git hub data. This is so cool!
        .then(function(data) {
            const planets = [];
            data.planets.forEach(function(obj) {
                planets.push({name: obj.name, distance: obj.semiMajorAxisAU});
            });
            draw(planets);
        });

function draw(distances) {
    const barScale = d3.scaleLinear()
    .domain([0, d3.max(distances, d =&gt; d.distance)]) 
    .range([0, 600]);

    const colorScale = d3.scaleLinear()
        .domain([0, d3.max(distances, d =&gt; d.distance)])
        .range([0,1])

    // selects the entire chart (one node)
    const chart = d3.select(&quot;body&quot;)
    .append(&quot;div&quot;).attr(&quot;class&quot;, &quot;bar-chart&quot;)
    .style(&quot;height&quot;, distances.length * 21 + &quot;px&quot;);

    // selects each entry (a nodelist)
    const entries = chart.selectAll(&quot;div&quot;).data(distances.sort((a,b) =&gt; d3.ascending(a.distance, b.distance)))
    .enter().append(&quot;div&quot;)
    .attr(&quot;class&quot;, &quot;entry&quot;)
    .style(&quot;top&quot;, (d,i) =&gt; i * 21 + &quot;px&quot;);


    entries.each(function(d) { 
    const entry = d3.select(this); // the current entry
    const fmt = d3.format(&quot;.2f&quot;); // format for each entry

    entry.append(&quot;div&quot;).attr(&quot;class&quot;, &quot;label category&quot;)
    .text(d.name);

    entry.append(&quot;div&quot;).attr(&quot;class&quot;, &quot;bar&quot;)
    .style(&quot;width&quot;, barScale(d.distance) + &quot;px&quot;)
    .style(&quot;background-color&quot;, d3.color('orange')
                        .darker(colorScale(d.distance)))

    entry.append(&quot;div&quot;).attr(&quot;class&quot;, &quot;label value&quot;)
    .style(&quot;left&quot;, (barScale(d.distance) + 100) + &quot;px&quot;)
    .text(d =&gt; fmt(d.distance) + &quot; AU&quot;);
    });
}
</code></pre>

<h2 id="creating-a-bar-chart-with-d3-and-svg">Creating a bar chart with D3 and SVG</h2>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../../../basics/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../../../basics/" class="btn btn-xs btn-link">
        Basics
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../chapter_2/chapter-2/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../chapter_2/chapter-2/" class="btn btn-xs btn-link">
        Chapter 2
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="">Windmill Dark</a> theme by None (noraj).</p>
</footer>

</body>
</html>